<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Batch File Downloader</title>
  <style>
    :root {
      --bg-body: #f7f8fc;
      --bg-card: #fff;
      --bg-card-hover: #f7f7ff;
      --text-primary: #333;
      --text-secondary: #555;
      --text-muted: #999;
      --text-dim: #aaa;
      --border-color: #eee;
      --border-light: #f0f0f0;
      --border-input: #ddd;
      --chip-bg: #fafafa;
      --chip-border: #ddd;
      --ext-bg: #eef;
      --dim-bg: #f0f0f0;
      --accent: #667eea;
      --accent2: #764ba2;
      --file-item-border: #f5f5f5;
      --scrollbar-thumb: #ddd;
      --progress-bg: #e8e8e8;
      --log-bg: #1e1e2e;
      --tip-bg: linear-gradient(135deg, #fff3cd, #ffeaa7);
      --tip-border: #f0d78e;
      --tip-text: #856404;
      --tip-close: #b8860b;
      --switch-off: #ccc;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-body: #1a1a2e;
        --bg-card: #23234a;
        --bg-card-hover: #2a2a55;
        --text-primary: #e0e0f0;
        --text-secondary: #b0b0d0;
        --text-muted: #7878a0;
        --text-dim: #6868a0;
        --border-color: #333366;
        --border-light: #2d2d55;
        --border-input: #444477;
        --chip-bg: #2a2a50;
        --chip-border: #444477;
        --ext-bg: #2a2a55;
        --dim-bg: #2a2a50;
        --file-item-border: #2d2d55;
        --scrollbar-thumb: #444;
        --progress-bg: #333366;
        --log-bg: #111122;
        --tip-bg: linear-gradient(135deg, #3d3520, #332d18);
        --tip-border: #5a4f2a;
        --tip-text: #d4b864;
        --tip-close: #c8a840;
        --switch-off: #555;
      }
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      width: 480px;
      min-height: 400px;
      font-family: 'Segoe UI', 'Microsoft YaHei', 'Hiragino Kaku Gothic Pro', 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--text-primary);
    }
    .app { display: flex; flex-direction: column; height: 100%; }

    .header {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 14px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 10;
    }
    .header svg { flex-shrink: 0; }
    .header h1 { font-size: 16px; font-weight: 600; color: #fff; letter-spacing: 0.5px; }
    .header .subtitle { font-size: 11px; color: rgba(255,255,255,0.75); margin-top: 2px; }
    .header-right { margin-left: auto; display: flex; align-items: center; position: relative; }

    .lang-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 14px;
      padding: 4px 10px;
      color: #fff;
      font-size: 11px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.2s;
      white-space: nowrap;
    }
    .lang-btn:hover { background: rgba(255,255,255,0.3); }
    .lang-btn svg { width: 14px; height: 14px; }

    .lang-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 6px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
      z-index: 999;
      min-width: 160px;
      overflow: visible;
    }
    .lang-dropdown.open { display: block; }
    .lang-option {
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.15s;
    }
    .lang-option:last-child { border-bottom: none; }
    .lang-option:hover { background: var(--bg-card-hover); }
    .lang-option.active { color: var(--accent); font-weight: 600; }
    .lang-option .check { font-size: 14px; color: var(--accent); }

    .body {
      flex: 1;
      background: var(--bg-body);
      border-radius: 16px 16px 0 0;
      margin-top: -1px;
      padding: 16px;
      overflow-y: auto;
      max-height: 520px;
      position: relative;
    }

    .section {
      background: var(--bg-card);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }
    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .section-title svg { width: 16px; height: 16px; }

    .format-grid { display: flex; flex-wrap: wrap; gap: 6px; }
    .format-chip {
      padding: 5px 12px;
      border-radius: 16px;
      border: 1.5px solid var(--chip-border);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--chip-bg);
      color: var(--text-primary);
      user-select: none;
    }
    .format-chip:hover { border-color: var(--accent); color: var(--accent); }
    .format-chip.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      border-color: transparent;
    }
    .custom-ext { display: flex; gap: 6px; margin-top: 8px; }
    .custom-ext input {
      flex: 1; padding: 6px 10px;
      border: 1.5px solid var(--border-input);
      border-radius: 8px; font-size: 12px; outline: none;
      background: var(--bg-card); color: var(--text-primary);
      transition: border 0.2s;
    }
    .custom-ext input:focus { border-color: var(--accent); }
    .custom-ext button {
      padding: 6px 14px; border: none; border-radius: 8px;
      background: #667eea; color: #fff; font-size: 12px;
      cursor: pointer; transition: background 0.2s;
    }
    .custom-ext button:hover { background: #5a6fd6; }

    .stealth-row {
      display: flex; align-items: center;
      justify-content: space-between; padding: 6px 0;
    }
    .stealth-row + .stealth-row { border-top: 1px solid var(--border-light); }
    .stealth-label { font-size: 12px; color: var(--text-secondary); }
    .stealth-desc { font-size: 10px; color: var(--text-muted); margin-top: 2px; }

    .switch { position: relative; width: 38px; height: 20px; flex-shrink: 0; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer; inset: 0;
      background: var(--switch-off); border-radius: 20px; transition: 0.3s;
    }
    .slider::before {
      content: ''; position: absolute; height: 16px; width: 16px;
      left: 2px; bottom: 2px; background: #fff;
      border-radius: 50%; transition: 0.3s;
    }
    .switch input:checked + .slider { background: #667eea; }
    .switch input:checked + .slider::before { transform: translateX(18px); }

    .delay-control {
      display: flex; align-items: center; gap: 10px;
      margin-top: 8px; padding: 8px 0 2px;
    }
    .delay-control input[type=range] { flex: 1; accent-color: #667eea; }
    .delay-value {
      font-size: 12px; color: var(--accent); font-weight: 600;
      min-width: 50px; text-align: right;
    }

    .file-list-header {
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 8px;
    }
    .file-count { font-size: 11px; color: var(--text-muted); }
    .select-actions { display: flex; gap: 8px; }
    .select-actions button {
      background: none; border: none; font-size: 11px;
      color: var(--accent); cursor: pointer; padding: 0;
    }
    .select-actions button:hover { text-decoration: underline; }

    .file-list {
      max-height: 200px; overflow-y: auto;
      border: 1px solid var(--border-color); border-radius: 8px;
    }
    .file-list::-webkit-scrollbar { width: 5px; }
    .file-list::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 5px; }

    .file-item {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 10px; font-size: 12px;
      border-bottom: 1px solid var(--file-item-border);
      transition: background 0.15s;
    }
    .file-item:last-child { border-bottom: none; }
    .file-item:hover { background: var(--bg-card-hover); }
    .file-item input[type=checkbox] { accent-color: #667eea; }
    .file-name {
      flex: 1; overflow: hidden; text-overflow: ellipsis;
      white-space: nowrap; color: var(--text-primary);
    }
    .file-ext {
      font-size: 10px; padding: 2px 6px; border-radius: 4px;
      background: var(--ext-bg); color: var(--accent);
      font-weight: 600; text-transform: uppercase;
    }
    .file-dim {
      font-size: 10px; color: var(--text-muted);
      background: var(--dim-bg); padding: 1px 5px;
      border-radius: 3px; white-space: nowrap; flex-shrink: 0;
    }

    .file-thumb {
      width: 28px; height: 28px; flex-shrink: 0;
      border-radius: 4px; object-fit: cover;
      background: var(--bg-card-hover); border: 1px solid var(--border-light);
      cursor: pointer; transition: opacity 0.15s;
    }
    .file-thumb.loading { opacity: 0.4; }
    .file-thumb.error { display: none; }
    .file-thumb-placeholder {
      width: 28px; height: 28px; flex-shrink: 0;
    }

    .thumb-preview {
      position: fixed; z-index: 9999;
      max-width: 320px; max-height: 320px;
      border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.35);
      border: 2px solid var(--accent);
      background: var(--bg-card); padding: 3px;
      pointer-events: none; opacity: 0;
      transition: opacity 0.15s;
    }
    .thumb-preview.show { opacity: 1; }
    .thumb-preview img {
      display: block; max-width: 314px; max-height: 314px;
      border-radius: 5px; object-fit: contain;
    }

    .empty-state {
      text-align: center; padding: 30px 10px;
      color: var(--text-dim); font-size: 13px;
    }
    .empty-state svg { margin-bottom: 8px; }

    .actions { display: flex; gap: 8px; margin-top: 4px; }
    .btn {
      flex: 1; padding: 10px; border: none; border-radius: 10px;
      font-size: 13px; font-weight: 600; cursor: pointer;
      transition: all 0.2s; display: flex;
      align-items: center; justify-content: center; gap: 6px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2); color: #fff;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(102,126,234,0.4); }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
    .btn-secondary {
      background: var(--bg-card); color: var(--accent);
      border: 1.5px solid var(--accent);
    }
    .btn-secondary:hover { background: var(--bg-card-hover); }
    .btn-pause { background: linear-gradient(135deg, #f0ad4e, #ec971f); color: #fff; }
    .btn-pause:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(240,173,78,0.4); }
    .btn-resume { background: linear-gradient(135deg, #5cb85c, #449d44); color: #fff; }
    .btn-resume:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(92,184,92,0.4); }
    .btn-stop { background: linear-gradient(135deg, #d9534f, #c9302c); color: #fff; }
    .btn-stop:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(217,83,79,0.4); }

    .progress-area { display: none; margin-top: 12px; }
    .progress-area.active { display: block; }
    .progress-bar-wrap {
      height: 6px; background: var(--progress-bg);
      border-radius: 6px; overflow: hidden;
    }
    .progress-bar {
      height: 100%; background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 6px; transition: width 0.3s; width: 0%;
    }
    .progress-text {
      display: flex; justify-content: space-between;
      font-size: 11px; color: var(--text-muted); margin-top: 6px;
    }

    .log-area {
      display: none; margin-top: 10px;
      background: var(--log-bg); border-radius: 8px;
      padding: 10px; max-height: 120px; overflow-y: auto;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 11px; line-height: 1.6;
    }
    .log-area.active { display: block; }
    .log-area::-webkit-scrollbar { width: 4px; }
    .log-area::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
    .log-item { color: #a0a0c0; }
    .log-item.success { color: #66d9a0; }
    .log-item.error { color: #ff7b7b; }
    .log-item.info { color: #7bc8ff; }

    .filter-bar { display: flex; gap: 0; margin-bottom: 8px; position: relative; }
    .filter-bar input {
      flex: 1; padding: 6px 10px; padding-right: 82px;
      border: 1.5px solid var(--border-color);
      border-radius: 8px; font-size: 12px; outline: none;
      background: var(--bg-card); color: var(--text-primary);
      transition: border 0.2s;
    }
    .filter-bar input:focus { border-color: var(--accent); }
    .filter-toggles {
      position: absolute; right: 4px; top: 50%; transform: translateY(-50%);
      display: flex; gap: 2px;
    }
    .filter-toggle {
      width: 24px; height: 22px; border: 1px solid transparent;
      border-radius: 4px; background: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-muted); font-size: 12px; font-weight: 600;
      font-family: 'Consolas','Courier New', monospace;
      transition: all 0.15s; padding: 0;
    }
    .filter-toggle:hover { background: var(--dim-bg); color: var(--text-secondary); }
    .filter-toggle.active {
      color: #fff; background: var(--accent);
      border-color: var(--accent);
    }
    .filter-toggle svg { width: 14px; height: 14px; }
    .filter-error {
      font-size: 10px; color: #d9534f; margin-top: 2px;
      display: none;
    }
    .filter-error.show { display: block; }

    .tip-banner {
      background: var(--tip-bg);
      border: 1px solid var(--tip-border);
      border-radius: 8px; padding: 10px 12px;
      margin-bottom: 12px; font-size: 11px;
      color: var(--tip-text);
      display: flex; align-items: flex-start; gap: 8px; line-height: 1.5;
    }
    .tip-banner svg { flex-shrink: 0; margin-top: 1px; }
    .tip-banner a { color: var(--accent); text-decoration: underline; cursor: pointer; }
    .tip-banner .close-tip {
      margin-left: auto; cursor: pointer; font-size: 14px;
      color: var(--tip-close); flex-shrink: 0; padding: 0 2px; line-height: 1;
    }
    .tip-banner .close-tip:hover { opacity: 0.7; }

    .file-source {
      font-size: 9px; padding: 1px 5px; border-radius: 3px;
      font-weight: 600; text-transform: uppercase; flex-shrink: 0;
    }
    .file-source.src-link { background: #e8f5e9; color: #2e7d32; }
    .file-source.src-image { background: #e3f2fd; color: #1565c0; }
    .file-source.src-media { background: #fce4ec; color: #c62828; }
    .file-source.src-css-bg { background: #f3e5f5; color: #7b1fa2; }
    .file-source.src-embed { background: #fff3e0; color: #e65100; }
    .file-source.src-srcset { background: #e0f7fa; color: #00838f; }
    .file-source.src-regex { background: #f5f5f5; color: #616161; }
    @media (prefers-color-scheme: dark) {
      .file-source.src-link { background: #1b3a1b; color: #66d9a0; }
      .file-source.src-image { background: #1a2a3a; color: #7bc8ff; }
      .file-source.src-media { background: #3a1a1e; color: #ff9090; }
      .file-source.src-css-bg { background: #2a1a3a; color: #c090e0; }
      .file-source.src-embed { background: #3a2a1a; color: #ffa060; }
      .file-source.src-srcset { background: #1a3a3a; color: #60d0e0; }
      .file-source.src-regex { background: #2a2a2a; color: #a0a0a0; }
    }

    .img-filter-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 6px;
    }
    .img-filter-grid label {
      font-size: 11px; color: var(--text-secondary);
      display: flex; align-items: center; gap: 4px;
    }
    .img-filter-grid input {
      width: 70px; padding: 4px 6px;
      border: 1.5px solid var(--border-input);
      border-radius: 6px; font-size: 11px; outline: none;
      background: var(--bg-card); color: var(--text-primary);
      transition: border 0.2s;
    }
    .img-filter-grid input:focus { border-color: var(--accent); }
    .img-presets { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px; }
    .img-preset {
      padding: 3px 10px; border-radius: 12px;
      border: 1px solid var(--chip-border); font-size: 10px;
      cursor: pointer; background: var(--chip-bg);
      color: var(--text-secondary); transition: all 0.2s;
    }
    .img-preset:hover { border-color: var(--accent); color: var(--accent); }

    .folder-input {
      display: flex; align-items: center; gap: 8px;
      margin-top: 8px; padding-top: 8px;
      border-top: 1px solid var(--border-light);
    }
    .folder-input label { font-size: 12px; color: var(--text-secondary); white-space: nowrap; }
    .folder-input input {
      flex: 1; padding: 5px 8px;
      border: 1.5px solid var(--border-input);
      border-radius: 6px; font-size: 11px; outline: none;
      background: var(--bg-card); color: var(--text-primary);
      transition: border 0.2s;
    }
    .folder-input input:focus { border-color: var(--accent); }

    .tab-bar {
      display: flex; gap: 0; margin-bottom: 12px;
      border-bottom: 2px solid var(--border-color);
    }
    .tab-btn {
      flex: 1; padding: 8px 0; border: none; background: none;
      font-size: 13px; font-weight: 600; color: var(--text-muted);
      cursor: pointer; border-bottom: 2px solid transparent;
      margin-bottom: -2px; transition: all 0.2s; text-align: center;
    }
    .tab-btn:hover { color: var(--text-secondary); }
    .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .folder-input-wrap {
      display: flex; align-items: center; gap: 4px; flex: 1; position: relative;
    }
    .folder-history-btn {
      width: 28px; height: 28px; border: 1.5px solid var(--border-input);
      border-radius: 6px; background: var(--bg-card); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-muted); transition: all 0.2s; flex-shrink: 0; padding: 0;
    }
    .folder-history-btn:hover { border-color: var(--accent); color: var(--accent); }

    .reset-section {
      text-align: center; margin-top: 16px; padding-top: 12px;
      border-top: 1px solid var(--border-light);
    }
    .btn-reset {
      padding: 8px 24px; border: 1.5px solid #d9534f; border-radius: 8px;
      background: none; color: #d9534f; font-size: 12px; font-weight: 600;
      cursor: pointer; transition: all 0.2s;
    }
    .btn-reset:hover { background: #d9534f; color: #fff; }
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="7 10 12 15 17 10"/>
      <line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
    <div>
      <h1 data-i18n="appTitle">Batch File Downloader</h1>
      <div class="subtitle" data-i18n="appSubtitle">Smart Scan &middot; Batch Download &middot; Anti-Detection</div>
    </div>
    <div class="header-right">
      <button class="lang-btn" id="langBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        <span id="currentLangName">EN</span>
      </button>
      <div class="lang-dropdown" id="langDropdown"></div>
    </div>
  </div>

  <div class="body">
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="main" data-i18n="tabMain">Download</button>
      <button class="tab-btn" data-tab="settings" data-i18n="tabSettings">Settings</button>
    </div>
    <div class="tab-content active" id="tabMain">
    <div class="tip-banner" id="tipBanner">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      <div data-i18n-html="tipContent">
        <strong>First-time tip: </strong>Chrome blocks consecutive auto-downloads by default. Click "Allow" on the banner that appears, or go to
        <a id="openSettings">Site Settings</a> &rarr; Auto-download &rarr; Allow.
      </div>
      <span class="close-tip" id="closeTip">&times;</span>
    </div>

    <div class="section">
      <div class="section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        <span data-i18n="sectionFormat">File Formats</span>
      </div>
      <div class="format-grid" id="formatGrid">
        <span class="format-chip active" data-ext="jpg">JPG</span>
        <span class="format-chip active" data-ext="png">PNG</span>
        <span class="format-chip" data-ext="gif">GIF</span>
        <span class="format-chip" data-ext="webp">WebP</span>
        <span class="format-chip" data-ext="svg">SVG</span>
        <span class="format-chip" data-ext="ico">ICO</span>
        <span class="format-chip" data-ext="pdf">PDF</span>
        <span class="format-chip" data-ext="doc">DOC</span>
        <span class="format-chip" data-ext="docx">DOCX</span>
        <span class="format-chip" data-ext="xls">XLS</span>
        <span class="format-chip" data-ext="xlsx">XLSX</span>
        <span class="format-chip" data-ext="ppt">PPT</span>
        <span class="format-chip" data-ext="pptx">PPTX</span>
        <span class="format-chip" data-ext="txt">TXT</span>
        <span class="format-chip" data-ext="csv">CSV</span>
        <span class="format-chip" data-ext="mp3">MP3</span>
        <span class="format-chip" data-ext="mp4">MP4</span>
        <span class="format-chip" data-ext="wav">WAV</span>
        <span class="format-chip" data-ext="avi">AVI</span>
        <span class="format-chip" data-ext="zip">ZIP</span>
        <span class="format-chip" data-ext="rar">RAR</span>
        <span class="format-chip" data-ext="7z">7Z</span>
      </div>
      <div class="custom-ext">
        <input type="text" id="customExt" data-i18n-ph="customExtPlaceholder" placeholder="Custom extension, e.g. psd">
        <button id="addExtBtn" data-i18n="addBtn">Add</button>
      </div>
    </div>

    <div class="section" id="imageFilterSection" style="display:none;">
      <div class="section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        <span data-i18n="sectionImageFilter">Image Filter</span>
      </div>
      <div class="img-filter-grid">
        <label><span data-i18n="imgMinW">Min width</span> <input type="number" id="imgMinWidth" min="0" placeholder="px"></label>
        <label><span data-i18n="imgMinH">Min height</span> <input type="number" id="imgMinHeight" min="0" placeholder="px"></label>
        <label><span data-i18n="imgMaxW">Max width</span> <input type="number" id="imgMaxWidth" min="0" placeholder="px"></label>
        <label><span data-i18n="imgMaxH">Max height</span> <input type="number" id="imgMaxHeight" min="0" placeholder="px"></label>
      </div>
      <div class="img-presets">
        <span class="img-preset" data-minw="100" data-minh="100">&ge; 100px</span>
        <span class="img-preset" data-minw="300" data-minh="300">&ge; 300px</span>
        <span class="img-preset" data-minw="500" data-minh="500">&ge; 500px</span>
        <span class="img-preset" data-minw="1024" data-minh="768">&ge; 1024&times;768</span>
        <span class="img-preset" data-minw="1920" data-minh="1080">&ge; 1080p</span>
        <span class="img-preset" data-minw="0" data-minh="0" data-maxw="0" data-maxh="0" data-i18n="imgPresetClear">Clear filter</span>
      </div>
    </div>

    <div class="section">
      <div class="section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
        <span data-i18n="sectionResult">Scan Results</span>
      </div>
      <div class="filter-bar">
        <input type="text" id="filterInput" data-i18n-ph="searchPlaceholder" placeholder="Search filenames...">
        <div class="filter-toggles">
          <button class="filter-toggle" id="filterCaseSensitive" title="Match Case (Alt+C)">Aa</button>
          <button class="filter-toggle" id="filterWholeWord" title="Match Whole Word (Alt+W)"><b>ab</b></button>
          <button class="filter-toggle" id="filterRegex" title="Use Regular Expression (Alt+R)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><text x="3" y="17" font-size="14" font-family="Consolas,monospace" fill="currentColor" stroke="none">.*</text></svg></button>
        </div>
      </div>
      <div class="filter-error" id="filterError"></div>
      <div class="file-list-header">
        <span class="file-count" id="fileCount" data-i18n="notScanned">Not scanned yet</span>
        <div class="select-actions">
          <button id="selectAllBtn" data-i18n="selectAll">Select all</button>
          <button id="deselectAllBtn" data-i18n="deselectAll">Deselect all</button>
        </div>
      </div>
      <div class="file-list" id="fileList">
        <div class="empty-state" id="emptyState">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--text-dim)" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <div data-i18n="emptyHint">Click "Scan Page" to discover files</div>
        </div>
      </div>
    </div>

    <div class="actions" id="normalActions">
      <button class="btn btn-secondary" id="scanBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <span data-i18n="scanBtn">Scan Page</span>
      </button>
      <button class="btn btn-primary" id="downloadBtn" disabled>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        <span data-i18n="downloadBtn">Download Selected</span> (<span id="selectedCount">0</span>)
      </button>
    </div>
    <div class="actions" id="queueActions" style="display:none;">
      <button class="btn btn-pause" id="pauseBtn" data-i18n="pauseBtn">Pause</button>
      <button class="btn btn-resume" id="resumeBtn" style="display:none;" data-i18n="resumeBtn">Resume</button>
      <button class="btn btn-stop" id="stopBtn" data-i18n="stopBtn">Stop</button>
    </div>

    <div class="progress-area" id="progressArea">
      <div class="progress-bar-wrap"><div class="progress-bar" id="progressBar"></div></div>
      <div class="progress-text">
        <span id="progressText" data-i18n="preparing">Preparing...</span>
        <span id="progressPercent">0%</span>
      </div>
    </div>

    <div class="log-area" id="logArea"></div>
    </div><!-- end tabMain -->

    <div class="tab-content" id="tabSettings">
      <div class="section">
        <div class="section-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          <span data-i18n="sectionStealth">Anti-Detection Settings</span>
        </div>
        <div class="stealth-row">
          <div>
            <div class="stealth-label" data-i18n="delayLabel">Random Download Delay</div>
            <div class="stealth-desc" data-i18n="delayDesc">Random interval between downloads to mimic human behavior</div>
          </div>
          <label class="switch"><input type="checkbox" id="stealthDelay" checked><span class="slider"></span></label>
        </div>
        <div class="delay-control" id="delayControl">
          <span style="font-size:11px;color:var(--text-muted);" data-i18n="delayRange">Delay range</span>
          <input type="range" id="delayMin" min="100" max="3000" value="300" step="100">
          <span class="delay-value" id="delayMinVal">0.3s</span>
          <span style="font-size:11px;color:var(--text-muted);">~</span>
          <input type="range" id="delayMax" min="200" max="5000" value="1500" step="100">
          <span class="delay-value" id="delayMaxVal">1.5s</span>
        </div>
        <div class="stealth-row">
          <div>
            <div class="stealth-label" data-i18n="shuffleLabel">Random Download Order</div>
            <div class="stealth-desc" data-i18n="shuffleDesc">Shuffle file order to avoid sequential crawling patterns</div>
          </div>
          <label class="switch"><input type="checkbox" id="stealthShuffle" checked><span class="slider"></span></label>
        </div>
        <div class="stealth-row">
          <div>
            <div class="stealth-label" data-i18n="refererLabel">Simulate Referer Header</div>
            <div class="stealth-desc" data-i18n="refererDesc">Automatically set current page as Referer</div>
          </div>
          <label class="switch"><input type="checkbox" id="stealthReferer" checked><span class="slider"></span></label>
        </div>
        <div class="stealth-row">
          <div>
            <div class="stealth-label" data-i18n="concurrencyLabel">Concurrency Limit</div>
            <div class="stealth-desc" data-i18n="concurrencyDesc">Number of simultaneous downloads (lower is safer)</div>
          </div>
          <div style="display:flex;align-items:center;gap:6px;">
            <input type="range" id="concurrency" min="1" max="5" value="2" style="width:80px;accent-color:#667eea;">
            <span class="delay-value" id="concurrencyVal" style="min-width:20px;">2</span>
          </div>
        </div>
        <div class="folder-input">
          <label data-i18n="subFolderLabel">Save to subfolder</label>
          <div class="folder-input-wrap">
            <input type="text" id="subFolder" data-i18n-ph="subFolderPlaceholder" placeholder="e.g. BatchDownload/images" value="BatchDownload">
            <button id="folderPickerBtn" class="folder-history-btn" title="Browse folder">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
            </button>
          </div>
        </div>
      </div>
      <div class="reset-section">
        <button id="resetFiltersBtn" class="btn-reset" data-i18n="resetFiltersBtn">Reset All Filters</button>
      </div>
    </div><!-- end tabSettings -->
  </div>
</div>
<script src="i18n.js"></script>
<script src="popup.js"></script>
</body>
</html>
